<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AWS Builder - AIdeas Leaderboard & Analytics</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #030712;
            --card: #111827;
            --card-hover: #1f2937;
            --accent: #ff9900;
            --accent-soft: rgba(255, 153, 0, 0.15);
            --accent-glow: rgba(255, 153, 0, 0.4);
            --text: #f9fafb;
            --text-dim: #9ca3af;
            --text-mute: #6b7280;
            --green: #10b981;
            --blue: #3b82f6;
            --purple: #a855f7;
            --border: #1f2937;
            --radius: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Outfit', sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            min-height: 100vh; 
            line-height: 1.5;
            background-image: 
                radial-gradient(at 0% 0%, rgba(255,153,0,0.03) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(59,130,246,0.03) 0px, transparent 50%);
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 24px 16px 60px; }

        /* --- Header --- */
        header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 32px; flex-wrap: wrap; gap: 16px; }
        .logo-area h1 { font-size: 28px; font-weight: 900; letter-spacing: -0.5px; background: linear-gradient(135deg, #fff 0%, var(--accent) 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .logo-area p { font-size: 13px; color: var(--text-dim); font-weight: 500; margin-top: 2px; display: flex; align-items: center; gap: 6px; }
        .live-indicator { width: 8px; height: 8px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.4; transform: scale(0.9); } }

        .header-actions { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
        .countdown-container { background: rgba(255,153,0,0.05); border: 1px solid rgba(255,153,0,0.2); padding: 8px 16px; border-radius: 12px; display: flex; align-items: center; gap: 10px; font-size: 13px; font-weight: 700; color: var(--accent); }
        #countdown-timer { font-family: monospace; font-size: 16px; font-weight: 900; }

        .refresh-btn {
            background: var(--accent); color: #000; border: none; padding: 10px 20px; border-radius: 12px;
            font-size: 14px; font-weight: 800; cursor: pointer; display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 20px var(--accent-glow); transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .refresh-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 25px var(--accent-glow); }
        .refresh-btn:active { transform: scale(0.97); }

        /* --- Competition Start Banner --- */
        .comp-banner { 
            background: rgba(59,130,246,0.1); border: 1px dashed var(--blue); padding: 12px 20px; border-radius: 12px; 
            margin-bottom: 24px; display: flex; align-items: center; gap: 12px; font-size: 13px; font-weight: 600; color: var(--blue);
        }

        /* --- Scorecard Hero --- */
        .hero-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px; }
        @media (min-width: 768px) { .hero-stats { grid-template-columns: repeat(4, 1fr); } }
        
        .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; transition: transform 0.2s, border-color 0.2s; }
        .card:hover { border-color: var(--text-mute); }
        .stat-label { font-size: 11px; color: var(--text-mute); text-transform: uppercase; font-weight: 800; letter-spacing: 0.5px; margin-bottom: 4px; }
        .stat-val { font-size: 32px; font-weight: 800; color: #fff; line-height: 1; }
        .stat-sub { font-size: 12px; color: var(--text-dim); margin-top: 6px; font-weight: 600; }

        /* --- Personal Rank Display --- */
        .rank-hero { 
            background: linear-gradient(145deg, #1e293b, #030712); border: 2px solid var(--accent); 
            border-radius: var(--radius); padding: 24px; margin-bottom: 32px; position: relative; overflow: hidden;
            box-shadow: 0 10px 40px var(--accent-soft);
        }
        .rank-hero::after { 
            content: ''; position: absolute; top: -50%; right: -20%; width: 300px; height: 300px; 
            background: radial-gradient(circle, rgba(255,153,0,0.1), transparent 70%); pointer-events: none;
        }
        .rank-grid { display: grid; grid-template-columns: 1fr; gap: 24px; position: relative; z-index: 1; }
        @media (min-width: 768px) { .rank-grid { grid-template-columns: 1fr 1fr; } }

        .rank-main { display: flex; align-items: center; gap: 20px; }
        .rank-badge { 
            width: 80px; height: 80px; background: var(--accent); color: #000; border-radius: 20px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; flex-shrink: 0;
            box-shadow: 0 8px 30px var(--accent-glow); transform: rotate(-3deg);
        }
        .rank-badge .lbl { font-size: 10px; font-weight: 900; text-transform: uppercase; }
        .rank-badge .num { font-size: 32px; font-weight: 950; }

        .rank-info h2 { font-size: 18px; font-weight: 800; color: #fff; margin-bottom: 6px; }
        .rank-info p { font-size: 14px; color: var(--text-dim); }

        .comp-comparison { background: rgba(255,255,255,0.03); border-radius: 12px; padding: 16px; border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px); }
        .comp-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .comp-row:last-child { margin-bottom: 0; }
        .comp-lbl { font-size: 11px; font-weight: 700; color: var(--text-mute); text-transform: uppercase; letter-spacing: 0.5px; }
        .comp-val { font-size: 14px; font-weight: 800; color: var(--accent); }
        .climb-tip { font-size: 12px; font-weight: 700; color: var(--green); margin-top: 10px; display: flex; align-items: center; gap: 8px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.05); }

        /* --- Analytics Section --- */
        .analytics-section { display: grid; grid-template-columns: 1fr; gap: 24px; margin-bottom: 32px; }
        @media (min-width: 768px) { .analytics-section { grid-template-columns: 1fr 1fr; } }
        .chart-container { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; height: 320px; display: flex; flex-direction: column; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .chart-header h3 { font-size: 14px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }

        /* --- Layout --- */
        .layout-main { display: grid; grid-template-columns: 1fr; gap: 24px; }
        @media (min-width: 900px) { .layout-main { grid-template-columns: 1fr 340px; } }

        /* --- Table Controls --- */
        .controls { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; flex-wrap: wrap; gap: 12px; }
        .filter-tabs { display: flex; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 4px; }
        .tab-btn { 
            border: none; background: none; color: var(--text-dim); padding: 8px 16px; border-radius: 8px; 
            font-size: 13px; font-weight: 700; cursor: pointer; transition: all 0.2s; 
        }
        .tab-btn.active { background: var(--accent); color: #000; }

        .search-box { position: relative; flex: 1; min-width: 250px; }
        .search-box input { 
            width: 100%; background: var(--card); border: 1px solid var(--border); border-radius: 12px; 
            padding: 10px 16px 10px 40px; color: #fff; font-family: inherit; font-size: 14px; outline: none;
            transition: border-color 0.2s;
        }
        .search-box input:focus { border-color: var(--accent); }
        .search-box svg { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--text-mute); }

        /* --- List --- */
        .rank-list { display: flex; flex-direction: column; gap: 10px; }
        .rank-item { 
            background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 14px 18px; 
            display: flex; align-items: center; gap: 16px; transition: all 0.2s; text-decoration: none; color: inherit;
        }
        .rank-item:hover { transform: translateX(4px); border-color: rgba(255,255,255,0.15); background: var(--card-hover); }
        .rank-item.highlighted { border-color: var(--accent); background: var(--accent-soft); }
        
        .item-rank { width: 36px; font-size: 18px; font-weight: 900; color: var(--text-mute); text-align: center; }
        .item-content { flex: 1; min-width: 0; }
        .item-title { font-size: 14px; font-weight: 700; color: #fff; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }
        .item-sub { font-size: 11px; color: var(--text-dim); display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .tag-comp { font-size: 8px; font-weight: 800; background: var(--blue); color: #fff; padding: 1px 4px; border-radius: 3px; text-transform: uppercase; }
        .tag-velocity { font-size: 9px; font-weight: 800; background: rgba(16,185,129,0.1); color: var(--green); padding: 1px 6px; border-radius: 10px; border: 1px solid rgba(16,185,129,0.2); }
        .tag-region { font-size: 8px; font-weight: 800; background: rgba(59,130,246,0.1); color: var(--blue); padding: 1px 6px; border-radius: 4px; border: 1px solid rgba(59,130,246,0.2); text-transform: uppercase; }
        
        .item-likes { text-align: right; min-width: 80px; display: flex; flex-direction: column; align-items: flex-end; }
        .likes-num { font-size: 18px; font-weight: 800; color: var(--accent); display: block; line-height: 1; }
        .likes-lbl { font-size: 8px; color: var(--text-mute); text-transform: uppercase; font-weight: 800; margin-top: 2px; }
        .forecast-num { font-size: 11px; font-weight: 800; color: var(--text-dim); margin-top: 4px; border-top: 1px solid var(--border); padding-top: 4px; width: 100%; text-align: right; }

        /* --- Sidebar stats --- */
        .sidebar { display: flex; flex-direction: column; gap: 24px; }
        .side-card h4 { font-size: 13px; font-weight: 800; text-transform: uppercase; margin-bottom: 12px; color: var(--accent); }
        .side-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 10px; color: var(--text-dim); }
        .side-row span:last-child { color: #fff; font-weight: 700; }

        /* --- Loading --- */
        #overlay { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; gap: 20px; }
        .loader { width: 40px; height: 40px; border: 4px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- Footer --- */
        footer { margin-top: 60px; padding: 24px 0; border-top: 1px solid var(--border); text-align: center; font-size: 12px; color: var(--text-mute); }
        footer a { color: var(--accent); text-decoration: none; font-weight: 700; }
    </style>
</head>
<body>
    <div id="overlay">
        <div class="loader"></div>
        <p style="font-weight: 800; letter-spacing: 0.5px">SYNCING COMPETITION DATA...</p>
        <div style="margin-top: 15px; text-align: center;">
            <div style="font-size: 14px; font-weight: 800; color: #fff; margin-bottom: 4px;">Directed & Developed by Shafayat Saad</div>
            <div style="font-size: 10px; color: var(--text-mute); font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">Full Stack Engineer & AI Architect</div>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 15px;">
                <a href="https://shafayatsaad.vercel.app/" target="_blank" style="color: var(--text-mute); transition: color 0.2s" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--text-mute)'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                </a>
                <a href="https://github.com/shafayatsaad" target="_blank" style="color: var(--text-mute); transition: color 0.2s" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--text-mute)'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
                </a>
                <a href="https://linkedin.com/in/shafayatsaad" target="_blank" style="color: var(--text-mute); transition: color 0.2s" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--text-mute)'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
                </a>
            </div>
        </div>
    </div>

    <div class="container" id="main" style="display: none">
        <header>
            <div class="logo-area">
                <h1>AIdeas Analyzer</h1>
                <div style="display: flex; align-items: center; gap: 12px; margin-top: 4px;">
                    <p style="margin:0"><span class="live-indicator"></span> Tracking AWS 10,000 AIdeas</p>
                    <div style="display: flex; gap: 8px; border-left: 1px solid var(--border); padding-left: 12px;">
                        <a href="https://shafayatsaad.vercel.app/" target="_blank" title="Portfolio" style="color: var(--text-mute); transition: color 0.2s" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--text-mute)'">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                        </a>
                        <a href="https://github.com/shafayatsaad" target="_blank" title="GitHub" style="color: var(--text-mute); transition: color 0.2s" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--text-mute)'">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
                        </a>
                        <a href="https://twitter.com/shafayatsaad" target="_blank" title="Twitter" style="color: var(--text-mute); transition: color 0.2s" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--text-mute)'">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <div class="countdown-container">
                    <span>NEXT REFRESH IN:</span>
                    <span id="countdown-timer">--:--</span>
                </div>
                <button class="refresh-btn" onclick="location.reload()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path></svg>
                    LIVE SYNC
                </button>
            </div>
        </header>

        <div class="comp-banner">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <div>
                <strong>COMPETITION DEADLINE:</strong> <span style="color:var(--accent)">March 13, 2026</span> &middot; 
                <span id="deadline-timer" style="font-weight: 900; letter-spacing: 0.5px">-- DAYS LEFT</span>
            </div>
        </div>

        <div id="meCardContainer"></div>

        <div class="hero-stats">
            <div class="card">
                <p class="stat-label">Feed Count</p>
                <p class="stat-val" id="statTotal">--</p>
                <p class="stat-sub">Recent articles</p>
            </div>
            <div class="card">
                <p class="stat-label">Competition Entries</p>
                <p class="stat-val" id="statComp">--</p>
                <p class="stat-sub">AIdeas matches</p>
            </div>
            <div class="card">
                <p class="stat-label">Max Velocity</p>
                <p class="stat-val" id="statMaxVel">--</p>
                <p class="stat-sub">Likes per day</p>
            </div>
            <div class="card">
                <p class="stat-label">Last Updated</p>
                <p class="stat-val" id="statUpdate" style="font-size: 18px; padding-top: 8px">--</p>
                <p class="stat-sub">Automatic tracking</p>
            </div>
        </div>

        <div id="meCardContainer"></div>

        <div class="layout-main">
            <div class="content-area">
                <div class="controls">
                    <div class="filter-tabs">
                        <button class="tab-btn active" onclick="setTab('comp', this)">Competition Leaderboard</button>
                        <button class="tab-btn" onclick="setTab('all', this)">Global Feed</button>
                    </div>
                    <div class="search-box">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                        <input type="text" placeholder="Filter articles..." onkeyup="handleSearch(this)">
                    </div>
                </div>
                <div class="rank-list" id="rankList"></div>
            </div>

            <div class="sidebar">
                <div class="card side-card">
                    <h4>Competition Health</h4>
                    <div class="side-row"><span>Detected entries</span><span id="sideCompN">--</span></div>
                    <div class="side-row"><span>Avg likes/entry</span><span id="sideCompAvg">--</span></div>
                    <div class="side-row"><span>Total engagements</span><span id="sideCompLikes">--</span></div>
                    <div class="side-row"><span>Competition %</span><span id="sideCompPct">--</span></div>
                </div>
                <div class="card side-card">
                    <h4>Builder Activity</h4>
                    <div class="side-row"><span>Recent Articles</span><span id="sideStatArt">--</span></div>
                    <div class="side-row"><span>Unique Authors</span><span id="sideStatAuth">--</span></div>
                    <div class="side-row"><span>Avg Velocity</span><span id="sideStatVelo">--</span></div>
                </div>
                <div class="card side-card" style="border-style: dashed; opacity: 0.8">
                    <h4>Top Velocity Gainers</h4>
                    <div id="velocityList"></div>
                </div>
            </div>
        </div>

        <footer>
            <div style="margin-bottom: 24px;">
                <p style="font-weight: 800; font-size: 14px; color: #fff; margin-bottom: 12px; letter-spacing: 0.5px;">Designed & Developed by Shafayat Saad</p>
                <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 15px;">
                    <a href="https://shafayatsaad.vercel.app/" target="_blank" title="Portfolio Site" style="display: flex; align-items: center; gap: 6px;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                        Portfolio
                    </a>
                    <a href="https://github.com/shafayatsaad" target="_blank" title="GitHub">GitHub</a>
                    <a href="https://twitter.com/shafayatsaad" target="_blank" title="Twitter">Twitter</a>
                    <a href="https://linkedin.com/in/shafayatsaad" target="_blank" title="LinkedIn">LinkedIn</a>
                </div>
            </div>
            <p>&copy; 2026 AWS Builder Competition Tracker &middot; API Monitoring Live</p>
            <p style="margin-top: 10px; font-size: 11px; color: var(--text-mute)">
                Competition timeframe starts <span style="color:var(--accent)">February 11, 2026</span> &middot; Tracking every 15m
            </p>
        </footer>
    </div>

    <script>
        const HIGHLIGHT_ID = "3AAMRb7l";
        const COMPETITION_END = new Date("2026-03-13T23:59:59");
        let allData = [];
        let currentTab = 'comp';
        let searchQuery = '';

        let scrapedAt = "";

        async function init() {
            try {
                const res = await fetch('aws_builder_likes.json?_=' + Date.now());
                const data = await res.json();
                
                // Handle new or old structure
                if (data.posts) {
                    allData = data.posts;
                    scrapedAt = data.scraped_at;
                } else {
                    allData = data;
                }
                
                // Sort by likes descending
                allData.sort((a,b) => b.likes_count - a.likes_count);
                
                // Remove duplicates
                const seen = new Set();
                allData = allData.filter(p => !seen.has(p.id) && seen.add(p.id));

                document.getElementById('overlay').style.display = 'none';
                document.getElementById('main').style.display = 'block';

                updateStats();
                renderMeCard();
                applyFilters();
                startRefreshCountdown();
            } catch (e) {
                console.error("Failed to load data", e);
                document.querySelector('#overlay p').textContent = "ERROR LOADING DATA. PLEASE ENSURE DATA.JSON EXISTS.";
                document.querySelector('.loader').style.borderTopColor = "#ef4444";
            }
        }

        function formatDate(created, published) {
            if (!created && !published) return "Unknown";
            try {
                // Prioritize published date if earlier, as it reflects when it was actually made live
                let dateObj = new Date(created);
                if (published) {
                    const pubObj = new Date(published);
                    if (!isNaN(pubObj.getTime())) {
                        if (isNaN(dateObj.getTime()) || pubObj < dateObj) {
                            dateObj = pubObj;
                        }
                    }
                }
                if (isNaN(dateObj.getTime())) return "Invalid Date";
                return dateObj.toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            } catch(e) { return created; }
        }

        function updateStats() {
            const total = allData.length;
            const compItems = allData.filter(p => p.is_competition);
            const compLikes = compItems.reduce((s, p) => s + (p.likes_count || 0), 0);
            const maxVelo = Math.max(...allData.map(p => p.velocity || 0));
            const avgVelo = allData.reduce((s, p) => s + (p.velocity || 0), 0) / total;
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statComp').textContent = compItems.length;
            document.getElementById('statMaxVel').textContent = maxVelo.toFixed(1);
            
            // Show scraped time if available, otherwise browser time
            const lastTime = scrapedAt ? formatDate(scrapedAt) : new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('statUpdate').textContent = lastTime;

            const diff = COMPETITION_END - new Date();
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            document.getElementById('deadline-timer').textContent = `${days}D ${hours}H REMAINING`;

            // Sidebar
            document.getElementById('sideCompN').textContent = compItems.length;
            document.getElementById('sideCompAvg').textContent = (compLikes / Math.max(1, compItems.length)).toFixed(1);
            document.getElementById('sideCompLikes').textContent = compLikes;
            document.getElementById('sideCompPct').textContent = ((compItems.length / total) * 100).toFixed(1) + '%';
            
            document.getElementById('sideStatArt').textContent = total;
            document.getElementById('sideStatAuth').textContent = new Set(allData.map(p => p.author_alias)).size;
            document.getElementById('sideStatVelo').textContent = avgVelo.toFixed(2);

            const topVelo = [...allData].sort((a,b) => b.velocity - a.velocity).slice(0, 5);
            document.getElementById('velocityList').innerHTML = topVelo.map(p => `
                <div class="side-row">
                    <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 150px; font-weight:600">${p.title}</span>
                    <span style="color:var(--green); font-weight:800">+${p.velocity}</span>
                </div>
            `).join('');
        }

        function renderMeCard() {
            const meIndex = allData.findIndex(p => p.id && p.id.includes(HIGHLIGHT_ID));
            if (meIndex === -1) return;

            const me = allData[meIndex];
            const compPosts = allData.filter(p => (p.is_competition || p.id.includes(HIGHLIGHT_ID)));
            const compRank = compPosts.findIndex(p => p.id && p.id.includes(HIGHLIGHT_ID)) + 1;

            // Prediction logic
            const now = new Date();
            const daysLeft = Math.max(0.1, (COMPETITION_END - now) / 86400000);
            
            const forecasted = Math.round(me.likes_count + (me.velocity * daysLeft));
            const topPost = compPosts[0];
            const topForecasted = Math.round(topPost.likes_count + (topPost.velocity * daysLeft));
            
            // Safe Win Buffer Calculation
            // We want to be at least 10 likes or 5% (whichever is higher) ahead of the top competitor's forecast
            const safetyMargin = Math.max(10, Math.round(topForecasted * 0.05));
            const safeTarget = topForecasted + safetyMargin;
            const safeBufferNeeded = Math.max(0, safeTarget - me.likes_count);
            const dailySafeAdd = (safeBufferNeeded / daysLeft).toFixed(1);

            // Win Probability logic
            const veloRatio = me.velocity / (topPost.velocity || 0.1);
            const scoreRatio = me.likes_count / topPost.likes_count;
            let winProb = Math.round((veloRatio * 60) + (scoreRatio * 30));
            if (compRank === 1) winProb = me.velocity >= topPost.velocity ? 98 : 85;
            winProb = Math.min(99, Math.max(5, winProb));

            const container = document.getElementById('meCardContainer');
            container.innerHTML = `
                <div class="rank-hero">
                    <div class="rank-grid">
                        <div class="rank-main">
                            <div class="rank-badge">
                                <span class="lbl">Rank</span>
                                <span class="num">#${compRank}</span>
                            </div>
                            <div class="rank-info">
                                <h2>${me.title}</h2>
                                <p style="color:var(--accent); font-weight:700">Currently #${compRank} in Competition</p>
                                <p style="margin-top:4px; font-size:13px; color:var(--text-dim)">
                                    Global Rank: #${meIndex + 1} &middot; 
                                    Speed: <strong style="color:var(--green)">${me.velocity || 0} likes/day</strong> &middot;
                                    <span style="opacity:0.8">Submitted: ${formatDate(me.created_at, me.last_published_at)}</span>
                                </p>
                            </div>
                        </div>
                        <div class="comp-comparison">
                            <div class="comp-row">
                                <span class="comp-lbl">üî≠ Forecasted Final</span>
                                <span class="comp-val">~${forecasted} LIKES</span>
                            </div>
                            <div class="comp-row">
                                <span class="comp-lbl">üõ°Ô∏è Safe-Win Buffer</span>
                                <span class="comp-val" style="color:var(--green)">+${safeBufferNeeded} LIKES NEEDED</span>
                            </div>
                            <div class="comp-row">
                                <span class="comp-lbl">üî• Win Probability</span>
                                <span class="comp-val" style="color:${winProb > 75 ? 'var(--green)' : 'var(--accent)'}">${winProb}%</span>
                            </div>
                            <div class="climb-tip">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="color:var(--accent)"><path d="m13 17 5-5-5-5"></path><path d="M6 17 11 12 6 7"></path></svg>
                                <span>Add <strong>${dailySafeAdd} likes/day</strong> to guarantee #1 by Mar 13</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function setTab(tab, el) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            applyFilters();
        }

        function handleSearch(el) {
            searchQuery = el.value.toLowerCase();
            applyFilters();
        }

        function applyFilters() {
            let data = allData;
            if (currentTab === 'comp') data = data.filter(p => p.is_competition);
            if (searchQuery) {
                data = data.filter(p => 
                    (p.title && p.title.toLowerCase().includes(searchQuery)) || 
                    (p.author_alias && p.author_alias.toLowerCase().includes(searchQuery))
                );
            }
            renderList(data);
        }

        function renderList(data) {
            const list = document.getElementById('rankList');
            if (data.length === 0) {
                list.innerHTML = `<div style="padding: 40px; text-align: center; color: var(--text-mute)">No posts found matching your criteria.</div>`;
                return;
            }

            const now = new Date();
            const daysLeft = Math.max(0.1, (COMPETITION_END - now) / 86400000);

            list.innerHTML = data.slice(0, 100).map((p, idx) => {
                const globalRank = allData.indexOf(p) + 1;
                const isMe = p.id && p.id.includes(HIGHLIGHT_ID);
                const medal = globalRank === 1 ? 'ü•á' : globalRank === 2 ? 'ü•à' : globalRank === 3 ? 'ü•â' : globalRank;
                const forecast = Math.round(p.likes_count + (p.velocity * daysLeft));
                const region = p.region || 'Global';

                return `
                    <a href="${p.url || '#'}" target="_blank" class="rank-item ${isMe ? 'highlighted' : ''}">
                        <div class="item-rank" ${globalRank <= 3 ? 'style="color:#fff"' : ''}>${medal}</div>
                        <div class="item-content">
                            <span class="item-title" style="display:flex; align-items:center, gap:8px">
                                ${p.title}
                                <span class="tag-region" style="background:var(--accent); color:#000; font-weight:800; font-size:10px; padding:2px 6px; border-radius:4px">${region}</span>
                            </span>
                            <div class="item-sub">
                                <span style="font-weight:700; color:var(--text-dim)">${p.author_alias ? '@'+p.author_alias : 'Anonymous'}</span>
                                ${p.is_competition ? '<span class="tag-comp" style="background:var(--purple); color:#fff">AIdeas</span>' : ''}
                                <span class="tag-velocity">‚ö° ${p.velocity || 0} v/d</span>
                                <span style="font-size:9px; opacity:0.6">${formatDate(p.created_at, p.last_published_at)}</span>
                            </div>
                        </div>
                        <div class="item-likes">
                            <span class="likes-num">${p.likes_count}</span>
                            <span class="likes-lbl">Likes</span>
                            <span class="forecast-num" title="Predicted likes by Mar 13" style="color:var(--accent)">üî≠ ~${forecast}</span>
                        </div>
                    </a>
                `;
            }).join('');
        }

        function startRefreshCountdown() {
            function update() {
                const now = new Date();
                const m = now.getMinutes();
                const s = now.getSeconds();
                const nextRefreshMin = 15 - (m % 15);
                const displayMin = (s === 0) ? nextRefreshMin : nextRefreshMin - 1;
                const displaySec = (60 - s) % 60;
                document.getElementById('countdown-timer').textContent = 
                    String(displayMin).padStart(2, '0') + ":" + String(displaySec).padStart(2, '0');
                
                // Also update the global deadline countdown every second
                const diff = COMPETITION_END - now;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const secs = Math.floor((diff % (1000 * 60)) / 1000);
                document.getElementById('deadline-timer').textContent = `${days}D ${hours}H ${mins}M ${secs}S REMAINING`;
            }
            setInterval(update, 1000);
            update();
        }

        init();
    </script>
</body>
</html>
